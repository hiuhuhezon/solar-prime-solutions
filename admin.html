<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Solar Prime Solutions</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-dark: #0f2027;
            --primary-mid: #203a43;
            --primary-light: #2c5364;
            --solar-orange: #FF9800;
            --inverter-blue: #2196F3;
            --battery-green: #4CAF50;
            --danger-red: #dc3545;
            --warning-yellow: #ffc107;
            --success-green: #28a745;
            --light-bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-dark: #333;
            --text-light: #666;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
            
            --solar-full-kits: #FF9800;
            --solar-panels: #4CAF50;
            --batteries: #2196F3;
            --inverters: #9C27B0;
            --solar-lighting: #FF5722;
            --water-heaters: #00BCD4;
            --water-pumps: #795548;
            --accessories: #607D8B;
            
            /* Blog colors */
            --blog-blue: #3498db;
            --blog-green: #2ecc71;
            --blog-purple: #9b59b6;
            --blog-red: #e74c3c;
            --blog-yellow: #f1c40f;
        }

        body {
            background: linear-gradient(135deg, var(--light-bg) 0%, #e9ecef 100%);
            color: var(--text-dark);
            min-height: 100vh;
        }

        header {
            background: linear-gradient(90deg, var(--primary-dark), var(--primary-light));
            color: white;
            padding: 1.5rem 5%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.2rem;
            color: #FFD700;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .logo span {
            color: #FFD700;
        }

        .store-link {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 2px solid transparent;
        }

        .store-link:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: #FFD700;
            transform: translateY(-2px);
        }

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 5%;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        @media (max-width: 1024px) {
            .admin-container {
                grid-template-columns: 1fr;
            }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e1e5eb;
        }

        .section-header h2 {
            font-size: 1.6rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-header i {
            color: var(--primary-light);
        }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        /* BLOG SPECIFIC STYLES */
        .blog-editor-container {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .blog-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e1e5eb;
        }

        .toolbar-btn {
            background: white;
            border: 1px solid #ddd;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .toolbar-btn:hover {
            background: #e9ecef;
            border-color: var(--primary-light);
        }

        .toolbar-btn.active {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-light);
        }

        .blog-editor {
            min-height: 400px;
            padding: 20px;
            border: 2px solid #e1e5eb;
            border-radius: 10px;
            background: white;
            font-size: 1.1rem;
            line-height: 1.6;
            outline: none;
            overflow-y: auto;
            transition: border-color 0.3s ease;
        }

        .blog-editor:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(44, 83, 100, 0.1);
        }

        .blog-editor h2 {
            color: var(--primary-dark);
            margin: 20px 0 10px 0;
            font-size: 1.8rem;
        }

        .blog-editor h3 {
            color: var(--primary-mid);
            margin: 15px 0 8px 0;
            font-size: 1.4rem;
        }

        .blog-editor p {
            margin-bottom: 15px;
        }

        .blog-editor ul, .blog-editor ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }

        .blog-editor blockquote {
            border-left: 4px solid var(--primary-light);
            padding-left: 20px;
            margin: 20px 0;
            font-style: italic;
            color: #666;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 0 8px 8px 0;
        }

        .blog-preview {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px dashed #c3cfe2;
            margin-top: 20px;
            display: none;
        }

        .blog-preview.show {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid #e1e5eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(44, 83, 100, 0.1);
        }

        select.form-control {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232c5364' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .image-upload-area {
            border: 3px dashed #c3cfe2;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #f5f7fa, #c3cfe2);
            margin-bottom: 20px;
        }

        .image-upload-area:hover {
            border-color: var(--primary-light);
            background: linear-gradient(45deg, #e9ecef, #b8c6db);
        }

        .image-upload-area.dragover {
            border-color: var(--success-green);
            background: rgba(40, 167, 69, 0.05);
        }

        .upload-icon {
            font-size: 3.5rem;
            color: var(--primary-light);
            margin-bottom: 15px;
        }

        .upload-text h4 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--primary-dark);
        }

        .upload-text p {
            color: var(--text-light);
            margin-bottom: 15px;
        }

        .upload-btn {
            background: var(--primary-light);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .upload-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .image-preview {
            margin-top: 20px;
            text-align: center;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        .id-generator {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .id-generator select {
            flex: 1;
        }

        .generate-id {
            background: var(--warning-yellow);
            color: var(--text-dark);
            border: none;
            padding: 14px 20px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .generate-id:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .submit-btn {
            background: var(--success-green);
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .submit-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .admin-products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .admin-product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            border: 1px solid #e1e5eb;
        }

        .admin-product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .admin-product-image {
            height: 180px;
            width: 100%;
            background: linear-gradient(45deg, #f5f7fa, #c3cfe2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
        }

        .admin-product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .admin-product-content {
            padding: 20px;
        }

        .admin-product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .admin-product-id {
            background: var(--light-bg);
            color: var(--primary-dark);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .admin-category-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .product-content h4 {
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 10px;
        }

        .admin-product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--solar-orange);
            margin-bottom: 15px;
        }

        .admin-product-desc {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 20px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .delete-btn {
            background: var(--danger-red);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .delete-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .clients-section {
            grid-column: 1 / -1;
        }

        .clients-table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: var(--shadow);
            background: white;
        }

        .clients-table {
            width: 100%;
            border-collapse: collapse;
        }

        .clients-table thead {
            background: linear-gradient(90deg, var(--primary-dark), var(--primary-light));
            color: white;
        }

        .clients-table th {
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 1rem;
        }

        .clients-table tbody tr {
            border-bottom: 1px solid #e1e5eb;
            transition: all 0.3s ease;
        }

        .clients-table tbody tr:hover {
            background: #f8f9fa;
        }

        .clients-table td {
            padding: 15px;
            vertical-align: top;
        }

        .client-product {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .product-category-small {
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }

        .client-message {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .client-date {
            white-space: nowrap;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .data-management {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .data-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
            justify-content: center;
        }

        .export-btn {
            background: var(--inverter-blue);
            color: white;
        }

        .export-btn:hover {
            background: #0b7dda;
            transform: translateY(-2px);
        }

        .clear-btn {
            background: var(--danger-red);
            color: white;
        }

        .clear-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: var(--shadow);
            border-top: 5px solid var(--primary-light);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary-light);
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--success-green);
            color: white;
            padding: 18px 25px;
            border-radius: 12px;
            box-shadow: var(--shadow-hover);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1001;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.4s ease;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification i {
            font-size: 1.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
            grid-column: 1 / -1;
        }

        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state h4 {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        /* Blog Cards */
        .admin-blogs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .admin-blog-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            border: 1px solid #e1e5eb;
            position: relative;
        }

        .admin-blog-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .admin-blog-image {
            height: 180px;
            width: 100%;
            background: linear-gradient(45deg, #f5f7fa, #c3cfe2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            overflow: hidden;
        }

        .admin-blog-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .admin-blog-card:hover .admin-blog-image img {
            transform: scale(1.1);
        }

        .admin-blog-content {
            padding: 20px;
        }

        .admin-blog-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .admin-blog-date {
            background: var(--light-bg);
            color: var(--text-light);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .admin-blog-category-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .blog-category-tips {
            background: rgba(52, 152, 219, 0.1);
            color: var(--blog-blue);
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .blog-category-installation {
            background: rgba(46, 204, 113, 0.1);
            color: var(--blog-green);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .blog-category-maintenance {
            background: rgba(155, 89, 182, 0.1);
            color: var(--blog-purple);
            border: 1px solid rgba(155, 89, 182, 0.3);
        }

        .blog-category-news {
            background: rgba(231, 76, 60, 0.1);
            color: var(--blog-red);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .blog-category-case-studies {
            background: rgba(241, 196, 15, 0.1);
            color: var(--blog-yellow);
            border: 1px solid rgba(241, 196, 15, 0.3);
        }

        .blog-content h4 {
            font-size: 1.2rem;
            color: var(--primary-dark);
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .admin-blog-excerpt {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .blog-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 0.85rem;
            color: #666;
        }

        .blog-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .blog-actions {
            display: flex;
            gap: 10px;
        }

        .edit-btn {
            background: var(--inverter-blue);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .edit-btn:hover {
            background: #0b7dda;
            transform: translateY(-2px);
        }

        /* Tags input */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            min-height: 50px;
            padding: 10px;
            border: 1px solid #e1e5eb;
            border-radius: 8px;
            background: white;
        }

        .tag {
            background: var(--primary-light);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .tag-remove {
            cursor: pointer;
            font-size: 0.8rem;
        }

        .tag-input {
            border: none;
            outline: none;
            padding: 5px;
            min-width: 100px;
            flex: 1;
        }

        /* Reading time indicator */
        .reading-time {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
        }

        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .admin-container {
                padding: 1.5rem;
            }
            
            .admin-products-grid,
            .admin-blogs-grid {
                grid-template-columns: 1fr;
            }
            
            .data-btn {
                min-width: 100%;
            }
            
            .clients-table {
                font-size: 0.9rem;
            }
            
            .clients-table th,
            .clients-table td {
                padding: 10px 8px;
            }
            
            .blog-toolbar {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .card {
                padding: 20px;
            }
            
            .id-generator {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stat-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Check login -->
    <script>
        const isLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';
        const loginTime = parseInt(sessionStorage.getItem('loginTime') || '0');
        const sessionTimeout = 2 * 60 * 60 * 1000;
        
        if (!isLoggedIn || (Date.now() - loginTime) > sessionTimeout) {
            window.location.href = 'login.html';
        }
    </script>

    <!-- Header -->
    <header>
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-sun"></i>
                <h1>Solar Prime Solutions Admin</h1>
            </div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <a href="product.html" class="store-link">
                    <i class="fas fa-store"></i>
                    View Products
                </a>
                <a href="blogs.html" class="store-link" style="background: rgba(52, 152, 219, 0.8);">
                    <i class="fas fa-blog"></i>
                    View Blogs
                </a>
                <button onclick="logout()" class="store-link" style="background: rgba(220, 53, 69, 0.8);">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </div>
    </header>

    <!-- Main Admin Container -->
    <div class="admin-container">
        <!-- Left Column: Add Product -->
        <div>
            <!-- Stats Cards -->
            <div class="stats-cards">
                <div class="stat-card">
                    <i class="fas fa-box-open stat-icon"></i>
                    <div class="stat-number" id="totalProducts">0</div>
                    <div class="stat-label">Total Products</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users stat-icon"></i>
                    <div class="stat-number" id="totalSubmissions">0</div>
                    <div class="stat-label">Client Inquiries</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-blog stat-icon"></i>
                    <div class="stat-number" id="totalBlogs">0</div>
                    <div class="stat-label">Blog Posts</div>
                </div>
            </div>

            <!-- Add Product Card -->
            <div class="card">
                <div class="section-header">
                    <h2><i class="fas fa-plus-circle"></i> Add New Product</h2>
                </div>
                
                <form id="addProductForm">
                    <div class="form-group">
                        <label for="productCategory">Product Category *</label>
                        <div class="id-generator">
                            <select id="productCategory" class="form-control" required>
                                <option value="">Select Category</option>
                                <option value="solar-full-kits">Solar Full Kits</option>
                                <option value="solar-panels">Solar Panels</option>
                                <option value="batteries">Batteries</option>
                                <option value="inverters">Inverters</option>
                                <option value="solar-lighting">Solar Lighting</option>
                                <option value="water-heaters">Water Heaters</option>
                                <option value="water-pumps">Water Pumps</option>
                                <option value="accessories">Accessories</option>
                            </select>
                            <button type="button" class="generate-id" id="generateIdBtn">
                                <i class="fas fa-bolt"></i> Generate ID
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="productId">Product ID *</label>
                        <input type="text" id="productId" class="form-control" placeholder="e.g., SFK001, SPN001, BAT001" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="productName">Product Name *</label>
                        <input type="text" id="productName" class="form-control" placeholder="Enter product name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="productPrice">Price (KSh) *</label>
                        <input type="number" id="productPrice" class="form-control" placeholder="0" min="0" step="100" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="shortDescription">Short Description *</label>
                        <textarea id="shortDescription" class="form-control" placeholder="Brief description for product card (max 100 characters)" maxlength="100" required></textarea>
                        <small style="color: var(--text-light); display: block; margin-top: 5px;">Max 100 characters</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="fullDescription">Full Description *</label>
                        <textarea id="fullDescription" class="form-control" placeholder="Detailed product specifications, features, benefits..." required></textarea>
                    </div>
                    
                    <!-- Image Upload -->
                    <div class="form-group">
                        <label>Product Image (Optional - Max 2MB)</label>
                        <div class="image-upload-area" id="imageUploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">
                                <h4>Drag & Drop or Click to Upload</h4>
                                <p>Max file size: 2MB (JPG, PNG, GIF)</p>
                                <button type="button" class="upload-btn" id="uploadBtn">
                                    <i class="fas fa-folder-open"></i> Browse Files
                                </button>
                            </div>
                            <input type="file" id="imageInput" accept=".jpg,.jpeg,.png,.gif" style="display: none;">
                        </div>
                        <div class="image-preview" id="imagePreview"></div>
                    </div>
                    
                    <button type="submit" class="submit-btn">
                        <i class="fas fa-save"></i> Add Product to Store
                    </button>
                </form>
            </div>
        </div>

        <!-- Right Column: Manage Products -->
        <div>
            <!-- Manage Products Card -->
            <div class="card">
                <div class="section-header">
                    <h2><i class="fas fa-boxes"></i> Manage Products</h2>
                    <span class="stat-label" id="productsCount">0 products</span>
                </div>
                
                <div class="admin-products-grid" id="adminProductsGrid">
                    <!-- Products will be loaded here -->
                    <div class="empty-state" id="noAdminProducts">
                        <i class="fas fa-sun"></i>
                        <h4>No Products Yet</h4>
                        <p>Add your first product using the form on the left.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clients Section -->
        <div class="clients-section">
            <div class="card">
                <div class="section-header">
                    <h2><i class="fas fa-comments"></i> Client Inquiries</h2>
                    <div class="data-management">
                        <button class="data-btn export-btn" id="exportClientsBtn">
                            <i class="fas fa-file-csv"></i> Export to CSV
                        </button>
                        <button class="data-btn clear-btn" id="clearClientsBtn">
                            <i class="fas fa-trash"></i> Clear All
                        </button>
                    </div>
                </div>
                
                <div class="clients-table-container">
                    <table class="clients-table" id="clientsTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Product</th>
                                <th>Client Name</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Message</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody">
                            <!-- Client submissions will be loaded here -->
                        </tbody>
                    </table>
                    <div class="empty-state" id="noClientsMessage" style="display: none;">
                        <i class="fas fa-envelope-open-text"></i>
                        <h4>No Client Inquiries Yet</h4>
                        <p>Customer inquiries will appear here when they use the contact form.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- BLOG MANAGEMENT SECTION -->
        <div class="blog-editor-container">
            <div class="card">
                <div class="section-header">
                    <h2><i class="fas fa-blog"></i> Blog Management</h2>
                    <div class="data-management">
                        <button class="data-btn export-btn" id="exportBlogsBtn">
                            <i class="fas fa-file-export"></i> Export Blogs
                        </button>
                        <button class="data-btn clear-btn" id="clearBlogsBtn">
                            <i class="fas fa-trash"></i> Clear All Blogs
                        </button>
                        <button type="button" class="data-btn" id="previewBlogBtn" style="background: var(--blog-blue);">
                            <i class="fas fa-eye"></i> Preview Blog
                        </button>
                    </div>
                </div>

                <!-- Blog Editor Form -->
                <form id="addBlogForm">
                    <div class="form-group">
                        <label for="blogTitle">Blog Title *</label>
                        <input type="text" id="blogTitle" class="form-control" placeholder="Enter a catchy blog title" required>
                    </div>

                    <div class="form-group">
                        <label for="blogCategory">Blog Category *</label>
                        <select id="blogCategory" class="form-control" required>
                            <option value="">Select Category</option>
                            <option value="tips">Solar Tips & Tricks</option>
                            <option value="installation">Installation Guides</option>
                            <option value="maintenance">Maintenance Tips</option>
                            <option value="news">Industry News</option>
                            <option value="case-studies">Case Studies</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="blogTags">Tags (Press Enter to add)</label>
                        <div class="tags-container" id="blogTagsContainer">
                            <input type="text" id="blogTagInput" class="tag-input" placeholder="Type tag and press Enter">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Featured Image (Optional - Max 2MB)</label>
                        <div class="image-upload-area" id="blogImageUploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">
                                <h4>Drag & Drop or Click to Upload</h4>
                                <p>Max file size: 2MB (JPG, PNG, GIF)</p>
                                <button type="button" class="upload-btn" id="blogUploadBtn">
                                    <i class="fas fa-folder-open"></i> Browse Files
                                </button>
                            </div>
                            <input type="file" id="blogImageInput" accept=".jpg,.jpeg,.png,.gif" style="display: none;">
                        </div>
                        <div class="image-preview" id="blogImagePreview"></div>
                    </div>

                    <div class="form-group">
                        <label>Blog Content *</label>
                        <div class="blog-toolbar" id="blogToolbar">
                            <button type="button" class="toolbar-btn" data-command="bold" title="Bold">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="italic" title="Italic">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="underline" title="Underline">
                                <i class="fas fa-underline"></i>
                            </button>
                            <div style="width: 1px; background: #ddd; margin: 0 5px;"></div>
                            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h2" title="Heading 2">
                                <i class="fas fa-heading"></i> H2
                            </button>
                            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="h3" title="Heading 3">
                                <i class="fas fa-heading"></i> H3
                            </button>
                            <div style="width: 1px; background: #ddd; margin: 0 5px;"></div>
                            <button type="button" class="toolbar-btn" data-command="insertUnorderedList" title="Bullet List">
                                <i class="fas fa-list-ul"></i>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="insertOrderedList" title="Numbered List">
                                <i class="fas fa-list-ol"></i>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="createLink" title="Insert Link">
                                <i class="fas fa-link"></i>
                            </button>
                            <div style="width: 1px; background: #ddd; margin: 0 5px;"></div>
                            <button type="button" class="toolbar-btn" id="insertImageBtn" title="Insert Image">
                                <i class="fas fa-image"></i>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="formatBlock" data-value="blockquote" title="Quote">
                                <i class="fas fa-quote-right"></i>
                            </button>
                            <button type="button" class="toolbar-btn" id="insertCodeBtn" title="Code Block">
                                <i class="fas fa-code"></i>
                            </button>
                            <div style="width: 1px; background: #ddd; margin: 0 5px;"></div>
                            <button type="button" class="toolbar-btn" id="clearFormatBtn" title="Clear Formatting">
                                <i class="fas fa-eraser"></i>
                            </button>
                        </div>
                        
                        <div class="blog-editor" id="blogEditor" contenteditable="true">
                            <p>Start writing your amazing blog post here...</p>
                            <p>You can use the toolbar above to format your text.</p>
                            <p>Add headings, lists, images, and more!</p>
                        </div>
                        
                        <div class="blog-preview" id="blogPreview">
                            <h3>Preview will appear here</h3>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="blogExcerpt">Short Excerpt (Optional)</label>
                        <textarea id="blogExcerpt" class="form-control" placeholder="Brief summary of the blog post (will be auto-generated if empty)" maxlength="200"></textarea>
                        <small style="color: var(--text-light); display: block; margin-top: 5px;">Max 200 characters</small>
                    </div>

                    <button type="submit" class="submit-btn" id="publishBlogBtn">
                        <i class="fas fa-paper-plane"></i> Publish Blog Post
                    </button>
                </form>
            </div>

            <!-- Manage Blogs Card -->
            <div class="card">
                <div class="section-header">
                    <h2><i class="fas fa-newspaper"></i> Manage Blog Posts</h2>
                    <span class="stat-label" id="blogsCount">0 blogs</span>
                </div>
                
                <div class="admin-blogs-grid" id="adminBlogsGrid">
                    <!-- Blogs will be loaded here -->
                    <div class="empty-state" id="noAdminBlogs">
                        <i class="fas fa-blog"></i>
                        <h4>No Blog Posts Yet</h4>
                        <p>Add your first blog post using the form above.</p>
                    </div>
                </div>
            </div>

            <!-- Data Management Card -->
            <div class="card">
                <div class="section-header">
                    <h2><i class="fas fa-database"></i> Data Management</h2>
                </div>
                
                <div class="data-management">
                    <button class="data-btn export-btn" id="exportAllBtn">
                        <i class="fas fa-file-export"></i> Export All Data (JSON)
                    </button>
                    <button class="data-btn clear-btn" id="clearAllBtn">
                        <i class="fas fa-broom"></i> Clear All Products
                    </button>
                </div>
                
                <p style="margin-top: 20px; color: var(--text-light); font-size: 0.95rem; line-height: 1.6;">
                    <i class="fas fa-info-circle"></i> All data is stored locally in your browser. 
                    Export regularly to backup your data. Clearing browser cache will delete all data.
                </p>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operation completed successfully!</span>
    </div>

    <script>
        // Logout function
        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            sessionStorage.removeItem('loginTime');
            window.location.href = 'login.html';
        }

        // Global variables
        let currentImageData = null;
        let currentBlogImageData = null;
        let products = [];
        let clientSubmissions = [];
        let blogs = [];
        let currentTags = [];
        let editingBlogId = null;

        // Initialize admin panel
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing Admin Panel...');
            initializeAdmin();
        });

        // Initialize admin
        function initializeAdmin() {
            try {
                loadAllData();
                setupEventListeners();
                updateStats();
                setupBlogEditor();
                console.log('Admin Panel initialized successfully');
            } catch (error) {
                console.error('Error initializing admin:', error);
                showNotification('Error loading admin panel. Please refresh.', 'error');
            }
        }

        // Load all data from localStorage
        function loadAllData() {
            try {
                // Load products
                const productsJSON = localStorage.getItem('solarStoreProducts');
                products = productsJSON ? JSON.parse(productsJSON) : [];
                
                // Validate products
                if (!Array.isArray(products)) {
                    products = [];
                }
                
                // Load client submissions
                const submissionsJSON = localStorage.getItem('solarStoreSubmissions');
                clientSubmissions = submissionsJSON ? JSON.parse(submissionsJSON) : [];
                
                // Validate submissions
                if (!Array.isArray(clientSubmissions)) {
                    clientSubmissions = [];
                }
                
                // Load blogs
                const blogsJSON = localStorage.getItem('solarStoreBlogs');
                blogs = blogsJSON ? JSON.parse(blogsJSON) : [];
                
                // Validate blogs
                if (!Array.isArray(blogs)) {
                    blogs = [];
                }
                
                // Update displays
                displayAdminProducts();
                displayClientSubmissions();
                displayAdminBlogs();
            } catch (error) {
                console.error('Error loading data:', error);
                products = [];
                clientSubmissions = [];
                blogs = [];
                displayAdminProducts();
                displayClientSubmissions();
                displayAdminBlogs();
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Existing product image upload
            const imageUploadArea = document.getElementById('imageUploadArea');
            const imageInput = document.getElementById('imageInput');
            const uploadBtn = document.getElementById('uploadBtn');
            
            if (uploadBtn) {
                uploadBtn.addEventListener('click', () => {
                    if (imageInput) imageInput.click();
                });
            }
            
            if (imageInput) {
                imageInput.addEventListener('change', handleImageUpload);
            }
            
            // Blog image upload
            const blogImageUploadArea = document.getElementById('blogImageUploadArea');
            const blogImageInput = document.getElementById('blogImageInput');
            const blogUploadBtn = document.getElementById('blogUploadBtn');
            
            if (blogUploadBtn) {
                blogUploadBtn.addEventListener('click', () => {
                    if (blogImageInput) blogImageInput.click();
                });
            }
            
            if (blogImageInput) {
                blogImageInput.addEventListener('change', handleBlogImageUpload);
            }
            
            // Drag and drop for blog images
            if (blogImageUploadArea) {
                blogImageUploadArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                
                blogImageUploadArea.addEventListener('dragleave', function() {
                    this.classList.remove('dragover');
                });
                
                blogImageUploadArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    
                    if (e.dataTransfer.files.length > 0) {
                        handleBlogImageFile(e.dataTransfer.files[0]);
                    }
                });
            }
            
            // Existing drag and drop for products
            if (imageUploadArea) {
                imageUploadArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                
                imageUploadArea.addEventListener('dragleave', function() {
                    this.classList.remove('dragover');
                });
                
                imageUploadArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    
                    if (e.dataTransfer.files.length > 0) {
                        handleImageFile(e.dataTransfer.files[0]);
                    }
                });
            }
            
            // Generate ID button
            const generateIdBtn = document.getElementById('generateIdBtn');
            if (generateIdBtn) {
                generateIdBtn.addEventListener('click', generateProductId);
            }
            
            // Form submission
            const addProductForm = document.getElementById('addProductForm');
            if (addProductForm) {
                addProductForm.addEventListener('submit', addProduct);
            }
            
            // Blog form submission
            const addBlogForm = document.getElementById('addBlogForm');
            if (addBlogForm) {
                addBlogForm.addEventListener('submit', addBlog);
            }
            
            // Data management buttons
            const exportClientsBtn = document.getElementById('exportClientsBtn');
            if (exportClientsBtn) exportClientsBtn.addEventListener('click', exportClientsToCSV);
            
            const clearClientsBtn = document.getElementById('clearClientsBtn');
            if (clearClientsBtn) clearClientsBtn.addEventListener('click', clearAllClients);
            
            const exportAllBtn = document.getElementById('exportAllBtn');
            if (exportAllBtn) exportAllBtn.addEventListener('click', exportAllData);
            
            const clearAllBtn = document.getElementById('clearAllBtn');
            if (clearAllBtn) clearAllBtn.addEventListener('click', clearAllProducts);
            
            const exportBlogsBtn = document.getElementById('exportBlogsBtn');
            if (exportBlogsBtn) exportBlogsBtn.addEventListener('click', exportBlogsToJSON);
            
            const clearBlogsBtn = document.getElementById('clearBlogsBtn');
            if (clearBlogsBtn) clearBlogsBtn.addEventListener('click', clearAllBlogs);
            
            const previewBlogBtn = document.getElementById('previewBlogBtn');
            if (previewBlogBtn) previewBlogBtn.addEventListener('click', previewBlog);
            
            // Use event delegation for delete buttons
            const adminProductsGrid = document.getElementById('adminProductsGrid');
            if (adminProductsGrid) {
                adminProductsGrid.addEventListener('click', function(e) {
                    const deleteBtn = e.target.closest('.delete-btn');
                    if (deleteBtn) {
                        const productId = deleteBtn.getAttribute('data-id');
                        if (productId) {
                            deleteProduct(productId);
                        }
                    }
                });
            }
            
            // Tags input
            const tagInput = document.getElementById('blogTagInput');
            if (tagInput) {
                tagInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const tag = this.value.trim();
                        if (tag && !currentTags.includes(tag)) {
                            addTag(tag);
                            this.value = '';
                        }
                    }
                });
            }
        }

        // Setup blog editor
        function setupBlogEditor() {
            const toolbar = document.getElementById('blogToolbar');
            const editor = document.getElementById('blogEditor');
            
            if (!toolbar || !editor) return;
            
            // Toolbar buttons
            toolbar.addEventListener('click', function(e) {
                const button = e.target.closest('.toolbar-btn');
                if (!button) return;
                
                const command = button.dataset.command;
                const value = button.dataset.value;
                
                if (command === 'createLink') {
                    const url = prompt('Enter the URL:');
                    if (url) {
                        document.execCommand(command, false, url);
                    }
                } else if (command === 'formatBlock' && value) {
                    document.execCommand(command, false, value);
                } else if (command) {
                    document.execCommand(command, false, null);
                }
                
                editor.focus();
            });
            
            // Insert image button
            const insertImageBtn = document.getElementById('insertImageBtn');
            if (insertImageBtn) {
                insertImageBtn.addEventListener('click', function() {
                    const url = prompt('Enter image URL (or leave blank to upload):');
                    if (url) {
                        document.execCommand('insertImage', false, url);
                    } else {
                        // Trigger image upload
                        document.getElementById('blogImageInput').click();
                    }
                    editor.focus();
                });
            }
            
            // Clear formatting button
            const clearFormatBtn = document.getElementById('clearFormatBtn');
            if (clearFormatBtn) {
                clearFormatBtn.addEventListener('click', function() {
                    document.execCommand('removeFormat', false, null);
                    document.execCommand('unlink', false, null);
                    editor.focus();
                });
            }
            
            // Insert code button
            const insertCodeBtn = document.getElementById('insertCodeBtn');
            if (insertCodeBtn) {
                insertCodeBtn.addEventListener('click', function() {
                    const code = '<pre><code>// Your code here</code></pre>';
                    document.execCommand('insertHTML', false, code);
                    editor.focus();
                });
            }
            
            // Auto-save draft every 30 seconds
            setInterval(saveBlogDraft, 30000);
            
            // Load draft if exists
            loadBlogDraft();
        }

        // Add tag function
        function addTag(tag) {
            currentTags.push(tag);
            updateTagsDisplay();
        }

        // Remove tag function
        function removeTag(index) {
            currentTags.splice(index, 1);
            updateTagsDisplay();
        }

        // Update tags display
        function updateTagsDisplay() {
            const container = document.getElementById('blogTagsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            currentTags.forEach((tag, index) => {
                const tagElement = document.createElement('span');
                tagElement.className = 'tag';
                tagElement.innerHTML = `
                    ${tag}
                    <span class="tag-remove" onclick="removeTag(${index})"></span>
                `;
                container.appendChild(tagElement);
            });
            
            const input = document.createElement('input');
            input.type = 'text';
            input.id = 'blogTagInput';
            input.className = 'tag-input';
            input.placeholder = currentTags.length ? 'Add another tag' : 'Type tag and press Enter';
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const tag = this.value.trim();
                    if (tag && !currentTags.includes(tag)) {
                        addTag(tag);
                        this.value = '';
                    }
                }
            });
            
            container.appendChild(input);
        }

        // Handle blog image upload
        function handleBlogImageUpload(e) {
            if (e.target.files && e.target.files.length > 0) {
                handleBlogImageFile(e.target.files[0]);
            }
        }

        // Process blog image file
        function handleBlogImageFile(file) {
            // Check file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                showNotification('File size exceeds 2MB limit. Please compress or choose a smaller image.', 'error');
                return;
            }
            
            // Check file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
            if (!validTypes.includes(file.type)) {
                showNotification('Invalid file type. Please upload JPG, PNG, or GIF images.', 'error');
                return;
            }
            
            // Convert to Base64 with compression
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Create canvas for compression
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Calculate new dimensions (max 1200px width)
                    const MAX_WIDTH = 1200;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > MAX_WIDTH) {
                        height *= MAX_WIDTH / width;
                        width = MAX_WIDTH;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Draw and compress
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Get compressed Base64
                    let compressedData;
                    if (file.type.includes('jpeg') || file.type.includes('jpg')) {
                        compressedData = canvas.toDataURL('image/jpeg', 0.8); // 80% quality for blogs
                    } else {
                        compressedData = canvas.toDataURL(file.type);
                    }
                    
                    currentBlogImageData = compressedData;
                    displayBlogImagePreview(currentBlogImageData);
                    
                    // Also insert into editor if user wants
                    if (confirm('Insert this image into the blog editor?')) {
                        const editor = document.getElementById('blogEditor');
                        if (editor) {
                            const imgHTML = `<img src="${compressedData}" alt="Blog Image" style="max-width: 100%; border-radius: 8px; margin: 20px 0;">`;
                            document.execCommand('insertHTML', false, imgHTML);
                            editor.focus();
                        }
                    }
                    
                    showNotification('Blog image uploaded successfully!');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Display blog image preview
        function displayBlogImagePreview(imageData) {
            const preview = document.getElementById('blogImagePreview');
            if (!preview) return;
            
            preview.innerHTML = `
                <img src="${imageData}" alt="Blog Preview">
                <p style="margin-top: 10px;">
                    <button type="button" class="upload-btn" id="removeBlogImageBtn" style="background: var(--danger-red);">
                        <i class="fas fa-trash"></i> Remove Image
                    </button>
                </p>
            `;
            
            // Add event listener to remove button
            const removeBtn = document.getElementById('removeBlogImageBtn');
            if (removeBtn) {
                removeBtn.addEventListener('click', function() {
                    currentBlogImageData = null;
                    preview.innerHTML = '';
                    showNotification('Blog image removed');
                });
            }
        }

        // Save blog draft
        function saveBlogDraft() {
            try {
                const draft = {
                    title: document.getElementById('blogTitle').value,
                    category: document.getElementById('blogCategory').value,
                    tags: currentTags,
                    content: document.getElementById('blogEditor').innerHTML,
                    excerpt: document.getElementById('blogExcerpt').value,
                    image: currentBlogImageData,
                    lastSaved: new Date().toISOString()
                };
                
                localStorage.setItem('solarBlogDraft', JSON.stringify(draft));
                console.log('Blog draft saved');
            } catch (error) {
                console.error('Error saving draft:', error);
            }
        }

        // Load blog draft
        function loadBlogDraft() {
            try {
                const draftJSON = localStorage.getItem('solarBlogDraft');
                if (draftJSON) {
                    const draft = JSON.parse(draftJSON);
                    
                    if (confirm('Load saved draft from ' + new Date(draft.lastSaved).toLocaleTimeString() + '?')) {
                        document.getElementById('blogTitle').value = draft.title || '';
                        document.getElementById('blogCategory').value = draft.category || '';
                        currentTags = draft.tags || [];
                        document.getElementById('blogEditor').innerHTML = draft.content || '';
                        document.getElementById('blogExcerpt').value = draft.excerpt || '';
                        currentBlogImageData = draft.image || null;
                        
                        updateTagsDisplay();
                        if (currentBlogImageData) {
                            displayBlogImagePreview(currentBlogImageData);
                        }
                        
                        showNotification('Blog draft loaded');
                    }
                }
            } catch (error) {
                console.error('Error loading draft:', error);
            }
        }

        // Add new blog
        function addBlog(e) {
            e.preventDefault();
            
            try {
                // Get form values
                const title = document.getElementById('blogTitle').value.trim();
                const category = document.getElementById('blogCategory').value;
                const content = document.getElementById('blogEditor').innerHTML;
                const excerpt = document.getElementById('blogExcerpt').value.trim() || 
                               generateExcerpt(content);
                
                // Validate required fields
                if (!title || !category || !content || content === '<p>Start writing your amazing blog post here...</p><p>You can use the toolbar above to format your text.</p><p>Add headings, lists, images, and more!</p>') {
                    showNotification('Please fill all required fields and add blog content', 'error');
                    return;
                }
                
                // Calculate reading time
                const readingTime = calculateReadingTime(content);
                
                // Generate unique ID
                const blogId = 'BLOG' + Date.now().toString().slice(-6);
                
                // Create blog object
                const blog = {
                    id: blogId,
                    title: title,
                    category: category,
                    categoryName: getBlogCategoryName(category),
                    tags: [...currentTags],
                    content: content,
                    excerpt: excerpt,
                    imageData: currentBlogImageData,
                    readingTime: readingTime,
                    author: 'Solar Prime Team',
                    datePublished: new Date().toISOString(),
                    views: 0,
                    likes: 0
                };
                
                if (editingBlogId) {
                    // Update existing blog
                    const index = blogs.findIndex(b => b.id === editingBlogId);
                    if (index !== -1) {
                        blogs[index] = { ...blogs[index], ...blog };
                        showNotification(`"${title}" updated successfully!`);
                    }
                    editingBlogId = null;
                } else {
                    // Add new blog
                    blogs.unshift(blog);
                    showNotification(`"${title}" published successfully!`);
                }
                
                // Save to localStorage
                localStorage.setItem('solarStoreBlogs', JSON.stringify(blogs));
                
                // Clear draft
                localStorage.removeItem('solarBlogDraft');
                
                // Reset form
                document.getElementById('addBlogForm').reset();
                document.getElementById('blogEditor').innerHTML = '<p>Start writing your amazing blog post here...</p><p>You can use the toolbar above to format your text.</p><p>Add headings, lists, images, and more!</p>';
                currentBlogImageData = null;
                currentTags = [];
                const blogImagePreview = document.getElementById('blogImagePreview');
                if (blogImagePreview) {
                    blogImagePreview.innerHTML = '';
                }
                updateTagsDisplay();
                
                // Update UI
                displayAdminBlogs();
                updateStats();
                
                // Scroll to blogs section
                const adminBlogsGrid = document.getElementById('adminBlogsGrid');
                if (adminBlogsGrid) {
                    adminBlogsGrid.scrollIntoView({ behavior: 'smooth' });
                }
                
            } catch (error) {
                console.error('Error adding blog:', error);
                showNotification('Error publishing blog. Please try again.', 'error');
            }
        }

        // Generate excerpt from content
        function generateExcerpt(content) {
            // Remove HTML tags
            const text = content.replace(/<[^>]*>/g, ' ');
            // Take first 150 characters
            return text.substring(0, 150).trim() + (text.length > 150 ? '...' : '');
        }

        // Calculate reading time
        function calculateReadingTime(content) {
            // Remove HTML tags
            const text = content.replace(/<[^>]*>/g, ' ');
            // Average reading speed: 200 words per minute
            const wordCount = text.split(/\s+/).length;
            const minutes = Math.ceil(wordCount / 200);
            return minutes;
        }

        // Get blog category name
        function getBlogCategoryName(category) {
            const names = {
                'tips': 'Solar Tips & Tricks',
                'installation': 'Installation Guides',
                'maintenance': 'Maintenance Tips',
                'news': 'Industry News',
                'case-studies': 'Case Studies'
            };
            return names[category] || 'Uncategorized';
        }

        // Get blog category class
        function getBlogCategoryClass(category) {
            const classes = {
                'tips': 'blog-category-tips',
                'installation': 'blog-category-installation',
                'maintenance': 'blog-category-maintenance',
                'news': 'blog-category-news',
                'case-studies': 'blog-category-case-studies'
            };
            return classes[category] || '';
        }

        // Display blogs in admin grid
        function displayAdminBlogs() {
            const grid = document.getElementById('adminBlogsGrid');
            const noBlogs = document.getElementById('noAdminBlogs');
            
            if (!grid) return;
            
            try {
                if (blogs.length === 0) {
                    if (noBlogs) {
                        grid.innerHTML = '';
                        grid.appendChild(noBlogs);
                        noBlogs.style.display = 'block';
                    }
                    document.getElementById('blogsCount').textContent = '0 blogs';
                    return;
                }
                
                if (noBlogs) {
                    noBlogs.style.display = 'none';
                }
                
                // Clear and rebuild grid
                grid.innerHTML = '';
                blogs.forEach(blog => {
                    try {
                        const card = createAdminBlogCard(blog);
                        grid.appendChild(card);
                    } catch (error) {
                        console.error('Error creating admin blog card:', error);
                    }
                });
                
                document.getElementById('blogsCount').textContent = `${blogs.length} blog${blogs.length !== 1 ? 's' : ''}`;
            } catch (error) {
                console.error('Error displaying admin blogs:', error);
                if (noBlogs) {
                    grid.innerHTML = '';
                    grid.appendChild(noBlogs);
                    noBlogs.style.display = 'block';
                }
            }
        }

        // Create admin blog card
        function createAdminBlogCard(blog) {
            const card = document.createElement('div');
            card.className = 'admin-blog-card';
            
            const categoryClass = getBlogCategoryClass(blog.category);
            const categoryName = blog.categoryName || getBlogCategoryName(blog.category);
            const date = new Date(blog.datePublished);
            const formattedDate = date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
            
            card.innerHTML = `
                <div class="admin-blog-image">
                    ${blog.imageData ? 
                        `<img src="${blog.imageData}" alt="${blog.title}">` : 
                        `<i class="fas fa-newspaper fa-3x"></i>`
                    }
                    <div class="reading-time">${blog.readingTime || 3} min read</div>
                </div>
                <div class="admin-blog-content">
                    <div class="admin-blog-header">
                        <span class="admin-blog-date">${formattedDate}</span>
                        <span class="admin-blog-category-badge ${categoryClass}">${categoryName}</span>
                    </div>
                    <div class="blog-content">
                        <h4>${blog.title || 'Untitled Blog'}</h4>
                        <p class="admin-blog-excerpt">${blog.excerpt || 'No excerpt available'}</p>
                        
                        <div class="blog-stats">
                            <div class="blog-stat">
                                <i class="fas fa-eye"></i>
                                <span>${blog.views || 0} views</span>
                            </div>
                            <div class="blog-stat">
                                <i class="fas fa-heart"></i>
                                <span>${blog.likes || 0} likes</span>
                            </div>
                            <div class="blog-stat">
                                <i class="fas fa-tags"></i>
                                <span>${blog.tags ? blog.tags.length : 0} tags</span>
                            </div>
                        </div>
                        
                        <div class="blog-actions">
                            <button class="edit-btn" data-id="${blog.id}" onclick="editBlog('${blog.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="delete-btn" data-id="${blog.id}" onclick="deleteBlog('${blog.id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Edit blog
        function editBlog(blogId) {
            const blog = blogs.find(b => b.id === blogId);
            if (!blog) return;
            
            // Fill form with blog data
            document.getElementById('blogTitle').value = blog.title;
            document.getElementById('blogCategory').value = blog.category;
            document.getElementById('blogEditor').innerHTML = blog.content;
            document.getElementById('blogExcerpt').value = blog.excerpt;
            currentTags = blog.tags || [];
            currentBlogImageData = blog.imageData || null;
            editingBlogId = blogId;
            
            // Update UI
            updateTagsDisplay();
            if (currentBlogImageData) {
                displayBlogImagePreview(currentBlogImageData);
            }
            
            // Scroll to editor
            document.getElementById('blogTitle').scrollIntoView({ behavior: 'smooth' });
            document.getElementById('blogTitle').focus();
            
            showNotification(`Editing: "${blog.title}"`);
        }

        // Delete blog
        function deleteBlog(blogId) {
            if (!blogId) return;
            
            if (!confirm('Are you sure you want to delete this blog post? This action cannot be undone.')) {
                return;
            }
            
            try {
                // Find blog name for notification
                const blog = blogs.find(b => b.id === blogId);
                const blogTitle = blog ? blog.title : 'Blog Post';
                
                // Remove from array
                const newBlogs = blogs.filter(b => b.id !== blogId);
                
                // Save to localStorage
                localStorage.setItem('solarStoreBlogs', JSON.stringify(newBlogs));
                blogs = newBlogs;
                
                // Update UI
                displayAdminBlogs();
                updateStats();
                showNotification(`"${blogTitle}" deleted successfully`);
            } catch (error) {
                console.error('Error deleting blog:', error);
                showNotification('Error deleting blog', 'error');
            }
        }

        // Preview blog
        function previewBlog() {
            const preview = document.getElementById('blogPreview');
            const title = document.getElementById('blogTitle').value;
            const content = document.getElementById('blogEditor').innerHTML;
            
            if (!title || !content) {
                showNotification('Please add title and content first', 'error');
                return;
            }
            
            preview.innerHTML = `
                <h3>Blog Preview</h3>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #ddd;">
                <h2 style="color: var(--primary-dark); margin-bottom: 15px;">${title}</h2>
                <div style="color: #666; margin-bottom: 20px;">
                    <i class="fas fa-calendar"></i> ${new Date().toLocaleDateString()} | 
                    <i class="fas fa-clock"></i> ${calculateReadingTime(content)} min read
                </div>
                <div style="line-height: 1.6; font-size: 1.1rem;">
                    ${content}
                </div>
            `;
            
            preview.classList.add('show');
            preview.scrollIntoView({ behavior: 'smooth' });
        }

        // Export blogs to JSON
        function exportBlogsToJSON() {
            if (blogs.length === 0) {
                showNotification('No blog data to export', 'error');
                return;
            }
            
            try {
                const exportData = {
                    blogs: blogs,
                    exportDate: new Date().toISOString(),
                    totalBlogs: blogs.length,
                    system: 'Solar Prime Solutions Blog System'
                };
                
                const json = JSON.stringify(exportData, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `solar_blogs_export_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification(`Exported ${blogs.length} blogs to JSON`);
            } catch (error) {
                console.error('Error exporting blogs:', error);
                showNotification('Error exporting blog data', 'error');
            }
        }

        // Clear all blogs
        function clearAllBlogs() {
            if (blogs.length === 0) {
                showNotification('No blog data to clear', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete all ${blogs.length} blog posts? This cannot be undone.`)) {
                return;
            }
            
            try {
                // Clear from localStorage
                localStorage.removeItem('solarStoreBlogs');
                localStorage.removeItem('solarBlogDraft');
                blogs = [];
                
                // Update UI
                displayAdminBlogs();
                updateStats();
                showNotification('All blog posts cleared');
            } catch (error) {
                console.error('Error clearing blogs:', error);
                showNotification('Error clearing blog data', 'error');
            }
        }

        // Update statistics
        function updateStats() {
            try {
                const totalProductsEl = document.getElementById('totalProducts');
                const totalSubmissionsEl = document.getElementById('totalSubmissions');
                const totalBlogsEl = document.getElementById('totalBlogs');
                
                if (totalProductsEl) {
                    totalProductsEl.textContent = products.length;
                }
                if (totalSubmissionsEl) {
                    totalSubmissionsEl.textContent = clientSubmissions.length;
                }
                if (totalBlogsEl) {
                    totalBlogsEl.textContent = blogs.length;
                }
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        // ========== EXISTING PRODUCT FUNCTIONS (KEEP AS IS) ==========
        // [All your existing product functions remain unchanged]
        // Handle image upload via file input
        function handleImageUpload(e) {
            if (e.target.files && e.target.files.length > 0) {
                handleImageFile(e.target.files[0]);
            }
        }

        // Process image file with compression
        function handleImageFile(file) {
            // Check file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                showNotification('File size exceeds 2MB limit. Please compress or choose a smaller image.', 'error');
                return;
            }
            
            // Check file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
            if (!validTypes.includes(file.type)) {
                showNotification('Invalid file type. Please upload JPG, PNG, or GIF images.', 'error');
                return;
            }
            
            // Convert to Base64 with compression
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Create canvas for compression
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Calculate new dimensions (max 800px width/height)
                    const MAX_SIZE = 800;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > height && width > MAX_SIZE) {
                        height *= MAX_SIZE / width;
                        width = MAX_SIZE;
                    } else if (height > MAX_SIZE) {
                        width *= MAX_SIZE / height;
                        height = MAX_SIZE;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Draw and compress
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Get compressed Base64
                    let compressedData;
                    if (file.type.includes('jpeg') || file.type.includes('jpg')) {
                        compressedData = canvas.toDataURL('image/jpeg', 0.7); // 70% quality for JPG
                    } else {
                        compressedData = canvas.toDataURL(file.type); // Original quality for PNG/GIF
                    }
                    
                    currentImageData = compressedData;
                    displayImagePreview(currentImageData);
                    
                    // Show compression info
                    const originalSize = formatBytes(file.size);
                    const compressedSize = formatBytes(Math.round(compressedData.length * 0.75)); // Approx Base64 to binary
                    showNotification(`Image uploaded successfully! ${originalSize}  ${compressedSize}`);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Format bytes to readable string
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }

        // Display image preview
        function displayImagePreview(imageData) {
            const preview = document.getElementById('imagePreview');
            if (!preview) return;
            
            preview.innerHTML = `
                <img src="${imageData}" alt="Preview">
                <p style="margin-top: 10px;">
                    <button type="button" class="upload-btn" id="removeImageBtn" style="background: var(--danger-red);">
                        <i class="fas fa-trash"></i> Remove Image
                    </button>
                </p>
            `;
            
            // Add event listener to remove button
            const removeBtn = document.getElementById('removeImageBtn');
            if (removeBtn) {
                removeBtn.addEventListener('click', function() {
                    currentImageData = null;
                    preview.innerHTML = '';
                    showNotification('Image removed');
                });
            }
        }

        // Generate product ID based on category
        function generateProductId() {
            const categorySelect = document.getElementById('productCategory');
            if (!categorySelect) return;
            
            const category = categorySelect.value;
            if (!category) {
                showNotification('Please select a category first', 'error');
                return;
            }
            
            // Get prefix based on category
            const prefixes = {
                'solar-full-kits': 'SFK',
                'solar-panels': 'SPN',
                'batteries': 'BAT',
                'inverters': 'INV',
                'solar-lighting': 'SLG',
                'water-heaters': 'WH',
                'water-pumps': 'WP',
                'accessories': 'ACC'
            };
            
            const prefix = prefixes[category] || 'PRO';
            
            // Get existing IDs for this category
            const existingIds = products
                .filter(p => p.id && p.id.startsWith(prefix))
                .map(p => {
                    const numPart = p.id.slice(prefix.length);
                    const num = parseInt(numPart);
                    return isNaN(num) ? 0 : num;
                })
                .sort((a, b) => a - b);
            
            // Find the next available number
            let nextNum = 1;
            for (let i = 0; i < existingIds.length; i++) {
                if (existingIds[i] !== i + 1) {
                    nextNum = i + 1;
                    break;
                }
                nextNum = existingIds[i] + 1;
            }
            
            // Format with leading zeros
            const formattedNum = nextNum.toString().padStart(3, '0');
            const productId = prefix + formattedNum;
            
            const productIdInput = document.getElementById('productId');
            if (productIdInput) {
                productIdInput.value = productId;
            }
        }

        // Add new product
        function addProduct(e) {
            e.preventDefault();
            
            try {
                // Get form values
                const category = document.getElementById('productCategory').value;
                const id = document.getElementById('productId').value;
                const name = document.getElementById('productName').value;
                const price = document.getElementById('productPrice').value;
                const shortDesc = document.getElementById('shortDescription').value;
                const fullDesc = document.getElementById('fullDescription').value;
                
                // Validate required fields
                if (!category || !id || !name || !price || !shortDesc || !fullDesc) {
                    showNotification('Please fill all required fields', 'error');
                    return;
                }
                
                // Validate price
                const priceNum = parseFloat(price);
                if (isNaN(priceNum) || priceNum < 0) {
                    showNotification('Please enter a valid price', 'error');
                    return;
                }
                
                // Check if ID already exists
                if (products.some(p => p.id === id)) {
                    showNotification('Product ID already exists. Please use a different ID.', 'error');
                    return;
                }
                
                // Create product object
                const product = {
                    id: id.trim(),
                    name: name.trim(),
                    category: category,
                    price: priceNum,
                    shortDesc: shortDesc.trim(),
                    fullDesc: fullDesc.trim(),
                    imageData: currentImageData,
                    dateAdded: new Date().toISOString()
                };
                
                // Add to products array
                const newProducts = [product, ...products];
                
                // Save to localStorage
                localStorage.setItem('solarStoreProducts', JSON.stringify(newProducts));
                products = newProducts;
                
                // Reset form
                document.getElementById('addProductForm').reset();
                currentImageData = null;
                const imagePreview = document.getElementById('imagePreview');
                if (imagePreview) {
                    imagePreview.innerHTML = '';
                }
                
                // Update UI
                displayAdminProducts();
                updateStats();
                showNotification(`"${name}" added successfully!`);
                
                // Scroll to products section
                const adminProductsGrid = document.getElementById('adminProductsGrid');
                if (adminProductsGrid) {
                    adminProductsGrid.scrollIntoView({ behavior: 'smooth' });
                }
                
            } catch (error) {
                console.error('Error adding product:', error);
                showNotification('Error adding product. Please try again.', 'error');
            }
        }

        // Display products in admin grid
        function displayAdminProducts() {
            const grid = document.getElementById('adminProductsGrid');
            const noProducts = document.getElementById('noAdminProducts');
            
            if (!grid) return;
            
            try {
                if (products.length === 0) {
                    if (noProducts) {
                        grid.innerHTML = '';
                        grid.appendChild(noProducts);
                        noProducts.style.display = 'block';
                    }
                    document.getElementById('productsCount').textContent = '0 products';
                    return;
                }
                
                if (noProducts) {
                    noProducts.style.display = 'none';
                }
                
                // Clear and rebuild grid
                grid.innerHTML = '';
                products.forEach(product => {
                    try {
                        const card = createAdminProductCard(product);
                        grid.appendChild(card);
                    } catch (error) {
                        console.error('Error creating admin product card:', error);
                    }
                });
                
                document.getElementById('productsCount').textContent = `${products.length} product${products.length !== 1 ? 's' : ''}`;
            } catch (error) {
                console.error('Error displaying admin products:', error);
                if (noProducts) {
                    grid.innerHTML = '';
                    grid.appendChild(noProducts);
                    noProducts.style.display = 'block';
                }
            }
        }

        // Get category color
        function getCategoryColor(category) {
            const colors = {
                'solar-full-kits': 'var(--solar-full-kits)',
                'solar-panels': 'var(--solar-panels)',
                'batteries': 'var(--batteries)',
                'inverters': 'var(--inverters)',
                'solar-lighting': 'var(--solar-lighting)',
                'water-heaters': 'var(--water-heaters)',
                'water-pumps': 'var(--water-pumps)',
                'accessories': 'var(--accessories)'
            };
            return colors[category] || '#666';
        }

        // Get category name
        function getCategoryName(category) {
            const names = {
                'solar-full-kits': 'Solar Full Kits',
                'solar-panels': 'Solar Panels',
                'batteries': 'Batteries',
                'inverters': 'Inverters',
                'solar-lighting': 'Solar Lighting',
                'water-heaters': 'Water Heaters',
                'water-pumps': 'Water Pumps',
                'accessories': 'Accessories'
            };
            return names[category] || category;
        }

        // Create admin product card
        function createAdminProductCard(product) {
            const card = document.createElement('div');
            card.className = 'admin-product-card';
            
            // Get category color and name
            const categoryColor = getCategoryColor(product.category);
            const categoryName = getCategoryName(product.category);
            
            // Format price in KSh
            const formattedPrice = new Intl.NumberFormat('en-KE', {
                style: 'currency',
                currency: 'KES',
                minimumFractionDigits: 0
            }).format(product.price);
            
            card.innerHTML = `
                <div class="admin-product-image">
                    ${product.imageData ? 
                        `<img src="${product.imageData}" alt="${product.name}">` : 
                        `<i class="fas fa-solar-panel fa-2x"></i>`
                    }
                </div>
                <div class="admin-product-content">
                    <div class="admin-product-header">
                        <span class="admin-product-id">${product.id || 'N/A'}</span>
                        <span class="admin-category-badge" style="background: ${categoryColor}20; color: ${categoryColor}; border: 1px solid ${categoryColor}40;">${categoryName}</span>
                    </div>
                    <h4>${product.name || 'Unnamed Product'}</h4>
                    <div class="admin-product-price">${formattedPrice}</div>
                    <p class="admin-product-desc">${product.shortDesc || 'No description'}</p>
                    <div class="product-actions">
                        <button class="delete-btn" data-id="${product.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Delete product
        function deleteProduct(productId) {
            if (!productId) return;
            
            if (!confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
                return;
            }
            
            try {
                // Find product name for notification
                const product = products.find(p => p.id === productId);
                const productName = product ? product.name : 'Product';
                
                // Remove from array
                const newProducts = products.filter(p => p.id !== productId);
                
                // Save to localStorage
                localStorage.setItem('solarStoreProducts', JSON.stringify(newProducts));
                products = newProducts;
                
                // Update UI
                displayAdminProducts();
                updateStats();
                showNotification(`"${productName}" deleted successfully`);
            } catch (error) {
                console.error('Error deleting product:', error);
                showNotification('Error deleting product', 'error');
            }
        }

        // Display client submissions
        function displayClientSubmissions() {
            const tableBody = document.getElementById('clientsTableBody');
            const noClientsMessage = document.getElementById('noClientsMessage');
            
            if (!tableBody) return;
            
            try {
                tableBody.innerHTML = '';
                
                if (clientSubmissions.length === 0) {
                    if (noClientsMessage) {
                        noClientsMessage.style.display = 'block';
                    }
                    return;
                }
                
                if (noClientsMessage) {
                    noClientsMessage.style.display = 'none';
                }
                
                // Add each submission to table
                clientSubmissions.forEach(submission => {
                    try {
                        const row = createClientTableRow(submission);
                        tableBody.appendChild(row);
                    } catch (error) {
                        console.error('Error creating client table row:', error);
                    }
                });
            } catch (error) {
                console.error('Error displaying client submissions:', error);
            }
        }

        // Create client table row
        function createClientTableRow(submission) {
            const row = document.createElement('tr');
            
            // Format date
            let formattedDate = 'N/A';
            try {
                const date = new Date(submission.date);
                formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            } catch (e) {
                console.warn('Invalid date format:', submission.date);
            }
            
            // Get category color and name
            const categoryColor = getCategoryColor(submission.productCategory);
            const categoryName = getCategoryName(submission.productCategory);
            
            // Sanitize data
            const productName = submission.productName || 'Unknown Product';
            const productId = submission.productId || 'N/A';
            const clientName = submission.clientName || 'N/A';
            const clientEmail = submission.clientEmail || 'N/A';
            const clientPhone = submission.clientPhone || 'N/A';
            const clientMessage = submission.clientMessage || 'No message';
            
            row.innerHTML = `
                <td class="client-date">${formattedDate}</td>
                <td>
                    <div class="client-product">
                        <span class="product-category-small" style="background: ${categoryColor};">${categoryName}</span>
                        <div>
                            <strong>${productName}</strong><br>
                            <small>${productId}</small>
                        </div>
                    </div>
                </td>
                <td><strong>${clientName}</strong></td>
                <td><a href="mailto:${clientEmail}">${clientEmail}</a></td>
                <td>${clientPhone}</td>
                <td class="client-message" title="${clientMessage}">${clientMessage}</td>
            `;
            
            return row;
        }

        // Export clients to CSV
        function exportClientsToCSV() {
            if (clientSubmissions.length === 0) {
                showNotification('No client data to export', 'error');
                return;
            }
            
            try {
                // Create CSV content
                let csv = 'Date,Product ID,Product Name,Category,Client Name,Email,Phone,Message\n';
                
                clientSubmissions.forEach(sub => {
                    const date = new Date(sub.date).toLocaleString();
                    const escapedMessage = (sub.clientMessage || '').replace(/"/g, '""');
                    csv += `"${date}","${sub.productId || ''}","${sub.productName || ''}","${getCategoryName(sub.productCategory) || ''}","${sub.clientName || ''}","${sub.clientEmail || ''}","${sub.clientPhone || ''}","${escapedMessage}"\n`;
                });
                
                // Create download link
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `solar_store_clients_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification(`Exported ${clientSubmissions.length} client inquiries to CSV`);
            } catch (error) {
                console.error('Error exporting CSV:', error);
                showNotification('Error exporting data', 'error');
            }
        }

        // Clear all clients
        function clearAllClients() {
            if (clientSubmissions.length === 0) {
                showNotification('No client data to clear', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete all ${clientSubmissions.length} client inquiries? This cannot be undone.`)) {
                return;
            }
            
            try {
                // Clear from localStorage
                localStorage.removeItem('solarStoreSubmissions');
                clientSubmissions = [];
                
                // Update UI
                displayClientSubmissions();
                updateStats();
                showNotification('All client inquiries cleared');
            } catch (error) {
                console.error('Error clearing clients:', error);
                showNotification('Error clearing client data', 'error');
            }
        }

        // Export all data as JSON
        function exportAllData() {
            try {
                const allData = {
                    products: products,
                    clientSubmissions: clientSubmissions,
                    blogs: blogs,
                    exportDate: new Date().toISOString(),
                    totalProducts: products.length,
                    totalSubmissions: clientSubmissions.length,
                    totalBlogs: blogs.length,
                    system: 'Solar Prime Solutions Admin System'
                };
                
                const json = JSON.stringify(allData, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `solar_prime_solutions_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('All data exported as JSON backup');
            } catch (error) {
                console.error('Error exporting data:', error);
                showNotification('Error exporting data', 'error');
            }
        }

        // Clear all products
        function clearAllProducts() {
            if (products.length === 0) {
                showNotification('No products to clear', 'error');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete all ${products.length} products? This cannot be undone.`)) {
                return;
            }
            
            try {
                // Clear from localStorage
                localStorage.removeItem('solarStoreProducts');
                products = [];
                
                // Update UI
                displayAdminProducts();
                updateStats();
                showNotification('All products cleared');
            } catch (error) {
                console.error('Error clearing products:', error);
                showNotification('Error clearing products', 'error');
            }
        }

        // Show notification
        function showNotification(message, type = 'success') {
            try {
                const notification = document.getElementById('notification');
                const icon = notification.querySelector('i');
                const text = document.getElementById('notificationText');
                
                if (!notification || !icon || !text) return;
                
                // Set icon and background based on type
                if (type === 'error') {
                    icon.className = 'fas fa-exclamation-circle';
                    notification.style.background = '#dc3545';
                } else if (type === 'warning') {
                    icon.className = 'fas fa-exclamation-triangle';
                    notification.style.background = '#ffc107';
                    notification.style.color = '#333';
                } else {
                    icon.className = 'fas fa-check-circle';
                    notification.style.background = '#28a745';
                }
                
                text.textContent = message;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 4000);
            } catch (error) {
                console.error('Error showing notification:', error);
            }
        }
        
        // Load data on page load
        loadAllData();
    </script>
</body>
</html>